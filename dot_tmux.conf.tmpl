{{- /* ----------------------------------------------------------------------------- */ -}}
{{- /* Snippet to determine if current machine is personal or for work */ -}}
{{- "" -}}
{{- $personalHostnames := splitList "," (onepasswordRead "op://dotfiles/personal/general/hostnames") -}}
{{- $personal := and (has .chezmoi.hostname $personalHostnames) "personal" -}}
{{- $workHostnames := splitList "," (onepasswordRead "op://dotfiles/work/general/hostnames") -}}
{{- $work := and (has .chezmoi.hostname $workHostnames) "work" -}}
{{- $type := or $personal $work -}}
{{- /* ----------------------------------------------------------------------------- */ -}}
{{- if not $type -}}
# This file is generated using a dotfiles manager called chezmoi,
# and uses 1Password to store and retrieve sensitive information to populate this file.
# Since "{{- .chezmoi.hostname -}}" is not among the listed hostnames stored in 1Password,
# chezmoi will not output any other configs to this file.
{{ else }}

############################################################
# Tmux Plugin Manager
# Prerequisites: install tpm
# git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
# prefix I:    Install plugins
# prefix U:    Update
# prefix a-u:  Unintall plugins not on the plugin list
set -g @plugin 'tmux-plugins/tpm'

# remap default clean key binding
# see https://github.com/tmux-plugins/tpm/issues/70
set -g @tpm-clean 'u'

############################################################
# tmux-plugins/tmux-sensible
# https://github.com/tmux-plugins/tmux-sensible
set -g @plugin 'tmux-plugins/tmux-sensible'

############################################################
# Manual: additional settings set manually

# also, two tips:
#   1) `prefix-[ is scrolling in tmux`
#   2) `prefix : show-options -g mouse`
set-option -g mouse on

############################################################
# Which key
# https://github.com/alexwforsythe/tmux-which-key
# prefix-space
#
# Installations Notes: If this has not been installed yet,
#                      first remove the config.yaml:
#                      rm -rf ~/.tmux/plugins/tmux-which-key/config.yaml
#                      Then run `chezmoi apply` again to
#                      restore the customized config.yaml
set -g @plugin 'alexwforsythe/tmux-which-key'

############################################################
# controlling panes
# https://github.com/tmux-plugins/tmux-pain-control
set -g @plugin 'tmux-plugins/tmux-pain-control'

############################################################
# Dracula Theme
# https://draculatheme.com/tmux
set -g @plugin 'dracula/tmux'

{{ if $work }}
set -g @dracula-plugins "battery git kubernetes-context time"
{{ else if $personal }}
set -g @dracula-plugins "battery git time"
{{ end }}

# configure powerline, separators as fonts don't look good with transparencies
set -g @dracula-show-powerline true
set -g @dracula-show-left-sep " "
set -g @dracula-show-right-sep " "

set -g @dracula-show-left-icon session
set -g @dracula-left-icon-padding 0

set -g @dracula-time-format "%a, %Y-%m-%d %H:%M"

# enable window flags
set -g @dracula-show-flags true

# refresh rate: default 5
set -g @dracula-refresh-rate 5

# enable high contrast pane border
set -g @dracula-border-contrast true

# hide these
set -g @dracula-show-empty-plugins false
set -g @dracula-cpu-display-load false
set -g @dracula-show-timezone false
set -g @dracula-hg-disable-status false
set -g @dracula-show-location false
set -g @dracula-network-bandwidth-show-interface false


set -g @dracula-git-disable-status false
set -g @dracula-git-show-remote-status false
set -g @dracula-show-only-kubernetes-context true
set -g @dracula-kubernetes-hide-user true
set -g @dracula-kubernetes-eks-extract-account false
set -g @dracula-kubernetes-eks-hide-arn true

############################################################
# restore tmux environment after system restart
# https://github.com/tmux-plugins/tmux-resurrect
#
# and doing it automatically...
# https://github.com/tmux-plugins/tmux-continuum
#
# prefix + c-s - save
# prefix + c-r - restore
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# for vim
set -g @resurrect-strategy-vim 'session'
# for neovim
set -g @resurrect-strategy-nvim 'session'

# automatic restore last saved environment
# !!! if tmux somehow unexpectedly exits on start,
# !!! try commenting out the following line
set -g @continuum-restore 'on'

# show Continuum status in tmux status line
# TODO: not sure if this works or not yet
set -g status-right 'Continuum status: #{continuum_status}'

# TODO: currently trying: https://github.com/rmagatti/auto-session
# TODO: next to try out: https://github.com/jedrzejboczar/possession.nvim
# TODO: https://github.com/tmux-plugins/tmux-resurrect/blob/master/docs/restoring_vim_and_neovim_sessions.md
# TODO: https://github.com/tpope/vim-obsession

############################################################
# https://github.com/sainnhe/tmux-fzf
# tmux-fzf
# prefix + F     (default) - clashes with tmux-fingers
# prefix + c-f   (custom)  - so I changed to this
#   - Manage sessions, windows, panes...
#   - Search commands and append to prompt
#   - Search clipboard history and paste to window
#   - Process management
#   - ...
set -g @plugin 'sainnhe/tmux-fzf'
TMUX_FZF_LAUNCH_KEY="C-f"

############################################################
# https://github.com/Morantron/tmux-fingers
# Quickly copy stuff
# prefix-F:      @fingers-key           Enter fingers mode
# prefis-J:      @fingers-jump-key      Enter fingers jump mode
#                @fingers-main-action   Copy tmux and clipboard
#                @fingers-ctrl-action   :open:
#                @fingers-alt-action    N/A
#                @fingers-shift-action  :paste:
#                @fingers-show-copied-notification
set -g @plugin 'Morantron/tmux-fingers'
set -g @fingers-show-copied-notification '1'

############################################################
# Copy to system clipboard
# https://github.com/tmux-plugins/tmux-yank
# Note: Reserved. Don't seem to need this right now.
# Normal mode: 
#     prefix-y: copies text from command line to clipboard
# Copy mode:
#     y: copy selection to system clipboard
#     Y: put selection - copy selection and paste to command line
# set -g @plugin 'tmux-plugins/tmux-yank'

############################################################
# open highlighted selection directly from tmux copy mode
set -g @plugin 'tmux-plugins/tmux-open'

############################################################
# https://github.com/wfxr/tmux-fzf-url
# prefix-u
set -g @plugin 'wfxr/tmux-fzf-url'
set -g @fzf-url-history-limit '2000'
set -g @fzf-url-fzf-options '-w 90% -h 50% --multi -0 --no-preview --border-label="tmux-fzf-url: open in browser (Tab to select multiple)"'

############################################################
# auto git fetch
# https://github.com/thepante/tmux-git-autofetch/
set -g @plugin 'thepante/tmux-git-autofetch'

############################################################
# address issue of error 127 when installing tpm
# https://github.com/tmux-plugins/tpm/issues/67#issuecomment-319561401
# set-environment -g PATH "/usr/local/bin:/bin:/usr/bin"
#
# https://github.com/tmux-plugins/tpm/issues/67#issuecomment-775411964
set-environment -g PATH "/opt/homebrew/bin:/usr/local/bin:/bin:/usr/bin"

############################################################
# Keep these at the very bottom
run -b '~/.tmux/plugins/tpm/tpm'

{{ end }}
